# File: azure-pipelines.yml

trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

stages:
  - stage: Build
    displayName: 'Build Stage'
    jobs:
      - job: Build
        displayName: 'Build Job'
        steps:
          - task: NodeTool@0
            inputs:
              versionSpec: '12.x'
            displayName: 'Install Node.js'

          - script: |
              echo 'Installing dependencies...'
              npm ci
            displayName: 'Install Dependencies'

          - script: |
              echo 'Building application...'
              npm run build
            displayName: 'Build'

  - stage: Test
    displayName: 'Test Stage'
    dependsOn: Build
    jobs:
      - job: UnitTests
        displayName: 'Run Unit Tests'
        steps:
          - script: |
              echo 'Running unit tests...'
              npm run test:unit
            displayName: 'Unit Tests'

      - job: IntegrationTests
        displayName: 'Run Integration Tests'
        steps:
          - script: |
              echo 'Running integration tests...'
              npm run test:integration
            displayName: 'Integration Tests'

  - stage: Deploy
    displayName: 'Deployment Stage'
    dependsOn: Test
    jobs:
      - deployment: DeployWebApp
        displayName: 'Deploy to Web App'
        environment: 'production'
        strategy:
          runOnce:
            deploy:
              steps:
                - task: AzureWebApp@1
                  inputs:
                    azureSubscription: '<Azure Subscription>'
                    appName: '<Web App Name>'
                    package: '$(Pipeline.Workspace)/<Path to deployment package>'
                  displayName: 'Deploy to Web App'
