# File: azure-pipelines.yml

trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

stages:
  - stage: Build
    displayName: 'Build Stage'
    jobs:
      - job: Build
        displayName: 'Build Job'
        steps:
          - task: NodeTool@0
            inputs:
              versionSpec: '12.x'
            displayName: 'Install Node.js'

          - script: |
              echo 'Installing dependencies...'
              npm install
            displayName: 'Install Dependencies'

          - script: |
              echo 'Building application...'
              npm run build
            displayName: 'Build'

  # - stage: Test
  #   displayName: 'Test Stage'
  #   dependsOn: Build
  #   jobs:
  #     - job: UnitTests
  #       displayName: 'Run Unit Tests'
  #       steps:
  #         - script: |
  #             echo 'Running unit tests...'
  #             npm install react-scripts -g
  #             npm install react -g
  #             npm run start
  #             npm run test
  #           displayName: 'Running Unit Tests'

  - stage: Deploy
    displayName: 'Deployment Stage'
    dependsOn: Build
    jobs:
      - deployment: DeployNetlify
        displayName: 'Deploy to Netlify'
        environment: 'production'
        strategy:
          runOnce:
            deploy:
              steps:
                - task: Npm@1
                  displayName: 'Install Netlify CLI'
                  inputs:
                    command: 'custom'
                    verbose: false
                    customCommand: 'install netlify-cli -g'

                - script: |
                    echo 'Deploying to Netlify...'
                    netlify deploy "--auth=E3-OKJelAYPBMPGkgLWFno_MO3cIuzZ5YJWqDUMRRMQ" "--site=cc48e103-3486-49e2-a20c-13cdd330496c" "--dir=$(Agent.WorkFolder)/1/s/build" --prod
                  displayName: 'Deploy to Netlify'
